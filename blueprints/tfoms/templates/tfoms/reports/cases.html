{% extends 'tfoms/base.html' %}

{% block title %}> {{ module_name }} > Отчёты{% endblock %}

{% block modules_css %}
<link href="{{ url_for('.static', filename='css/style.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='jquery-ui/css/cupertino/jquery-ui-1.10.2.custom.min.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}

    {% include 'tfoms/_nav_menu.html' %}

    <legend>Услуги по счёту №{{ data.account.number }} ({{ data.account.date|datetimeformat('%d/%m/%Y') }})</legend>
    {% if data.items %}
        <table class="table table-striped table-bordered table-condensed" id="table_cases">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Дата оказания услуги</th>
                    <th>ФИО</th>
                    <th>Пол</th>
                    <th>Дата рождения</th>
                    <th>Общая сумма за услугу</th>
                    <th>Количество оказанных услуг</th>
                    <th>Единица учета услуги</th>
                    <th>Дата загрузки из ТФОМС</th>
                    <th>Файл, загруженный из ТФОМС</th>
                    <th>Причина отказа</th>
                    <th>Примечание</th>
                </tr>
            </thead>
            <tbody>
            {% for case in data.items %}
                <tr{% if case.refuseTypeCode %} class="error"{% endif %}>
                    <td>{{ case.id }}</td>
                    <td>{{ case.serviceDate|datetimeformat('%d/%m/%Y') }}</td>
                    <td>{{ case.lastName }} {{ case.firstName }} {{ case.patrName }}</td>
                    <td>{% if case.sex == 1 %}М{% elif case.sex == 2 %}Ж{% endif %}</td>
                    <td>{% if case.birthDate %}{{ case.birthDate|datetimeformat('%d/%m/%Y') }}{% endif %}</td>
                    <td>{{ case.price|float }}</td>
                    <td>{{ case.amount|float }}</td>
                    <td>{{ case.unitName }}</td>
                    <td>{% if case.date %}{{ case.date|datetimeformat('%d/%m/%Y') }}{% endif %}</td>
                    <td>{{ case.fileName }}</td>
                    <td>{% if case.refuseTypeCode %}<strong>{{ case.refuseTypeCode }}</strong> {% endif %}{{ case.refuseTypeName|default("", True) }}</td>
                    <td>{{ case.note }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="row-fluid">
            <div class="span12" id="page_container"></div>
        </div>
    {% else %}
        <div class="alert alert-error">
            Услуги отсутствуют
        </div>
    {% endif %}
{% endblock %}
{% block modules_js %}
{{ super() }}
<script type="text/javascript">
    paginate_table($('#table_cases'), $('#page_container'));
</script>
{% endblock %}