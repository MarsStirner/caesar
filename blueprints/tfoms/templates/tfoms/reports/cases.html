{% extends 'tfoms/base.html' %}

{% block title %}> {{ module_name }} > Отчёты{% endblock %}

{% block modules_css %}
<link href="{{ url_for('.static', filename='css/style.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='jquery-ui/css/cupertino/jquery-ui-1.10.2.custom.min.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}

    {% include 'tfoms/_nav_menu.html' %}

    <legend>Услуги по счёту №{{ bill.account.number }} ({{ bill.account.date|datetimeformat('%d/%m/%Y') }})</legend>
    {% if bill.items %}
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Дата оказания услуги</th>
                    <th>ФИО</th>
                    <th>Пол</th>
                    <th>Дата рождения</th>
                    <th>Общая сумма за услугу</th>
                    <th>Количество оказанных услуг</th>
                    <th>Единица учета услуги</th>
                    <th>Дата загрузки из ТФОМС</th>
                    <th>Файл, загруженный из ТФОМС</th>
                    <th>Причина отказа</th>
                    <th>Примечание</th>
                </tr>
            </thead>
            <tbody>
            {% for case in bill.items %}
                <tr{% if case.refuseTypeCode %} class="error"{% else %} class="success"{% endif %}>
                    <td>{{ case.id }}</td>
                    <td>{{ case.serviceDate|datetimeformat('%d/%m/%Y') }}</td>
                    <td>{{ case.lastName }} {{ case.firstName }} {{ case.patrName }}</td>
                    <td>{% if case.sex == '1' %}М{% elif case.sex == '2' %}Ж{% endif %}</td>
                    <td>{{ case.birthDate|datetimeformat('%d/%m/%Y') }}</td>
                    <td>{{ case.price|float }}</td>
                    <td>{{ case.amount|float }}</td>
                    <td>{{ case.unitName }}</td>
                    <td>{{ case.date|datetimeformat('%d/%m/%Y') }}</td>
                    <td>{{ case.fileName }}</td>
                    <td>{{ case.refuseTypeName }}</td>
                    <td>{{ case.refuseTypeCode }}</td>
                    <td>{{ case.note }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="row-fluid">
            <div class="span12">
                {% macro render_pagination(pagination, endpoint, bill_id) %}
                  <div class=pagination>
                  <ul>
                  {%- for page in pagination.iter_pages() %}
                    {% if page %}
                      {% if page != pagination.page %}
                        <li><a href="{{ url_for(endpoint, bill_id=bill_id, page=page) }}">{{ page }}</a></li>
                      {% else %}
                        <li class="disabled"><a>{{ page }}</a></li>
                      {% endif %}
                    {% else %}
                      <li><span class=ellipsis>…</span></li>
                    {% endif %}
                  {%- endfor %}
                  </ul>
                  </div>
                {% endmacro %}
                {{ render_pagination(pagination, '.report_cases', request.view_args.get('bill_id')) }}
            </div>
        </div>
    {% else %}
        <div class="alert alert-error">
            Услуги отсутствуют
        </div>
    {% endif %}
{% endblock %}