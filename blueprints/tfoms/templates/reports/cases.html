{% extends 'base.html' %}

{% block title %}> {{ module_name }} > Отчёты{% endblock %}

{% block modules_css %}
<link href="{{ url_for('.static', filename='css/style.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='jquery-ui/css/cupertino/jquery-ui-1.10.2.custom.min.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}

    {% include '_nav_menu.html' %}

    <legend>Услуги по счёту №{{ bill.NSCHET }} ({{ bill.DSCHET|datetimeformat('%d/%m/%Y') }})</legend>
    {% if cases %}
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>ФИО</th>
                    <th>Дата рождения</th>
                    <th>Пол</th>
                    <th>СНИЛС</th>
                    <th>Полис</th>
                    <th>Условия</th>
                    <th>Дата начала лечения</th>
                    <th>Дата окончания лечения</th>
                    <th>Тариф</th>
                    <th>УЕТ</th>
                    <th>Выставленная сумма за услугу</th>
                    <th>Причина отказа</th>
                    <th>Примечание</th>
                </tr>
            </thead>
            <tbody>
            {% for case in cases %}
                <tr{% if case.REFREASON == '0' %} class="success"{% elif case.REFREASON %} class="error"{% endif %}>
                    <td>{{ case.patient.FAM }} {{ case.patient.IM }} {{ case.patient.OT }}</td>
                    <td>{{ case.patient.DR|datetimeformat('%d/%m/%Y') }}</td>
                    <td>{% if case.patient.W == '1' %}М{% elif case.patient.W == '2' %}Ж{% endif %}</td>
                    <td>{{ case.patient.SNILS or '' }}</td>
                    <td>{{ case.patient.SPOLIS or '' }}&nbsp;{{ case.patient.NPOLIS or '' }}</td>
                    <td>{{ case.USL_OK }}</td>
                    <td>{{ case.DATE_1|datetimeformat('%d/%m/%Y') }}</td>
                    <td>{{ case.DATE_2|datetimeformat('%d/%m/%Y') }}</td>
                    <td>{{ case.TARIF }}</td>
                    <td>{{ case.services|length }}</td>
                    <td>{{ case.SUMV }}</td>
                    <td>{{ case.REFREASON or '' }}</td>
                    <td>{% if case.COMENTSL %}{{ case.COMENTSL or '' }}{% endif %}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="row-fluid">
            <div class="span12">
                {% macro render_pagination(pagination, endpoint, bill_id) %}
                  <div class=pagination>
                  <ul>
                  {%- for page in pagination.iter_pages() %}
                    {% if page %}
                      {% if page != pagination.page %}
                        <li><a href="{{ url_for(endpoint, bill_id=bill_id, page=page) }}">{{ page }}</a></li>
                      {% else %}
                        <li class="disabled"><a>{{ page }}</a></li>
                      {% endif %}
                    {% else %}
                      <li><span class=ellipsis>…</span></li>
                    {% endif %}
                  {%- endfor %}
                  </ul>
                  </div>
                {% endmacro %}
                {{ render_pagination(pagination, '.report_cases', request.view_args.get('bill_id')) }}
            </div>
        </div>
    {% else %}
        <div class="alert alert-error">
            Услуги отсутствуют
        </div>
    {% endif %}
{% endblock %}